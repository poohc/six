<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="admin">
    
    <select id="selectJoinPartnerCount" parameterType="java.util.HashMap" resultType="Integer">
		SELECT COUNT(*)		       
		  FROM SIX_PARTNER
		 WHERE 1=1 
		  <if test="name != null">
		   AND NAME = #{name}
		   </if>
    </select>    
    
    <select id="selectJoinPartnerList" parameterType="java.util.HashMap" resultType="java.util.HashMap">
		SELECT SEQ,
		       ID,
		       NAME,
		       (SELECT CD_NAME
		          FROM SIX_COMMON_CODE A 
		         WHERE A.CD = REQUEST_CD) REQUEST_NAME,
		       IMAGE,
		       POST,
		       INTRODUCE,
		       SLOGAN,
		       (SELECT CD_NAME
		          FROM SIX_COMMON_CODE A 
		         WHERE A.CD = BANK_CD) BANK_NAME,
		       ACCOUNT_NO,
		       ACCOUNT_NAME,
		       CREATE_DATE,
		       IS_CONFIRM,
		       UPDATE_USER_ID,
		       UPDATE_DATE
		  FROM SIX_PARTNER
		 WHERE 1=1
		   <if test="name != null">
		   AND NAME = #{name}
		   </if>		   
	  ORDER BY SEQ DESC
		   <if test="start != null">
		 LIMIT #{start},#{end}    
		   </if>      		   
    </select>       
    
    <select id="selectPartnerInfo" parameterType="String" resultType="java.util.HashMap">
    	SELECT SEQ,
		       ID,
		       NAME,
		       REQUEST_CD,
		       (SELECT CD_NAME
		          FROM SIX_COMMON_CODE A 
		         WHERE A.CD = REQUEST_CD) REQUEST_NAME,
		       IMAGE,
		       POST,
		       INTRODUCE,
		       SLOGAN,
		       BANK_CD,
		       (SELECT CD_NAME
		          FROM SIX_COMMON_CODE A 
		         WHERE A.CD = BANK_CD) BANK_NAME,
		       ACCOUNT_NO,
		       ACCOUNT_NAME,
		       CREATE_DATE,
		       IS_CONFIRM,
		       UPDATE_USER_ID,
		       UPDATE_DATE
		  FROM SIX_PARTNER
		 WHERE SEQ = #{seq}
	</select>
	
    <update id="updatePartner" parameterType="java.util.HashMap">
        UPDATE SIX_PARTNER
           <set>
	          <if test="requestCd != null">REQUEST_CD=#{requestCd},</if>
	          <if test="image != null">IMAGE=#{image},</if>
	      	  <if test="post != null">POST=post,</if>
	      	  <if test="introduce != null">INTRODUCE=#{introduce},</if>
	      	  <if test="slogan != null">SLOGAN=#{slogan},</if>
	      	  <if test="bankCd != null">BANK_CD=#{bankCd},</if>
	      	  <if test="accountNo != null">ACCOUNT_NO=#{accountNo},</if>
	      	  <if test="accountName != null">ACCOUNT_NAME=#{accountName},</if>
	      	  <if test="isConfirm != null">IS_CONFIRM=#{isConfirm},</if>
	      	  UPDATE_USER_ID = #{updateUserId},
		      UPDATE_DATE = now()
	       </set>
         WHERE SEQ = #{seq}
    </update>
    
    <select id="selectCommonCodeList" resultType="java.util.HashMap">
        SELECT SEQ,
               CD,
               CD_NAME,
               CD_TYPE,
               CREATE_DATE,
               CREATE_ID
               UPDATE_DATE,
               UPDATE_ID
          FROM SIX_COMMON_CODE
      ORDER BY CD_TYPE, SEQ
    </select>
    
    <update id="updateCommonCode" parameterType="java.util.HashMap">
        UPDATE SIX_COMMON_CODE
           <set>
	         <if test="cdName != null">CD_NAME=#{cdName},</if>
	         UPDATE_USER_ID = #{updateUserId},
		     UPDATE_DATE = now()
	       </set>
         WHERE SEQ = #{seq}
    </update>
    
    <insert id="insertCommonCode" parameterType="java.util.HashMap">
        INSERT INTO SIX_COMMON_CODE
        			(
        				CD,
        				CD_NAME,
        				CD_TYPE,
        				CREATE_DATE,
        				CREATE_ID
        			)
        			VALUES
        			(
        				#{cd},
        				#{cdName},
        				#{cdType},
        				now(),
        				#{createId}
        			)
    </insert>
    
    <select id="selectRoleCount" parameterType="java.util.HashMap" resultType="Integer">
	    SELECT COUNT(*)
		  FROM SIX_AUTHORITY
		 WHERE ID = #{id}
		   AND AUTHORITY = #{authority}
    </select>
    
    <insert id="insertAuthority" parameterType="java.util.HashMap">
    	INSERT INTO SIX_AUTHORITY(
    	                          ID, 
    	                          AUTHORITY
    	                         )
    	                   VALUES(
    	                          #{id},
    	                          #{authority}
    	                         )
    </insert>
    
    <select id="selectRequestPointCount" parameterType="java.util.HashMap" resultType="Integer">
        SELECT COUNT(*)
          FROM SIX_POINT
         WHERE IS_VALID = 'Y'
           AND IS_CONFIRM = 'N'       
           AND POINT_TYPE = 'POINT001'
    </select>
    
    <select id="selectRequestPointList" parameterType="java.util.HashMap" resultType="java.util.HashMap">
        SELECT SEQ,
               ID,
               NAME,
               POINT,
               MONEY,
               PAYMENT_METHOD,
               (SELECT CD_NAME
                  FROM SIX_COMMON_CODE
                 WHERE CD = PAYMENT_METHOD) PAYMENT_METHOD_NAME,
               MSG,
               CREATE_DATE,
               CREATE_ID,
               UPDATE_DATE,
               UPDATE_ID,
               IS_VALID,
               IS_CONFIRM,
               CONFIRM_DATE,
               CONFIRM_ID,
               CANCEL_DATE,
               CANCEL_ID    
          FROM SIX_POINT
         WHERE IS_VALID = 'Y'
           AND IS_CONFIRM = 'N'       
           AND POINT_TYPE = 'POINT001'
      ORDER BY SEQ DESC
		   <if test="start != null">
		 LIMIT #{start},#{end}    
		   </if>    
    </select>
    
    <update id="updateSixPointConfirm" parameterType="java.util.HashMap">
        UPDATE SIX_POINT
           <set>
	          <if test="updateId != null">
	              UPDATE_DATE = now()
	              ,UPDATE_ID = #{updateId}
	          </if>
	          <if test="isConfirm != null and (isConfirm eq 'Y'.toString())">
	              ,IS_CONFIRM = #{isConfirm}
	              ,CONFIRM_DATE = now()
	              ,CONFIRM_ID = #{confirmId}	
	          </if>
	          <if test="isConfirm != null and (isConfirm eq 'N'.toString())">
	              ,IS_CONFIRM = #{isConfirm}
	              ,CANCEL_DATE = now()
	              ,CANCEL_ID = #{cancelId}
	          </if>	          
	       </set>
         WHERE SEQ IN
         <foreach collection="array" item="item" index="index" separator="," open="(" close=")">
		    ${array[index]}
		</foreach>         
    </update>
   
   <select id="selectSixCounselingCount" parameterType="java.util.HashMap" resultType="Integer">
		SELECT COUNT(*)		       
		  FROM SIX_COUNSELING		 
    </select>
   
   <select id="selectSixCounseling" parameterType="java.util.HashMap" resultType="java.util.HashMap">
       SELECT SEQ,
      		  TERMS_AGREE,
           	  QNA1,
           	  QNA2,
           	  QNA3,
           	  NAME,
              CELLPHONE,
              SUBSTRING(CELLPHONE,1,3) CELLPHONE_1,
	     	  CASE LENGTH(CELLPHONE) WHEN 11 THEN SUBSTRING(CELLPHONE,4,4) 
		                             WHEN 10 THEN SUBSTRING(CELLPHONE,4,3) END AS CELLPHONE_2,
  	     	  CASE LENGTH(CELLPHONE) WHEN 11 THEN SUBSTRING(CELLPHONE,8,4) 
		      	                     WHEN 10 THEN SUBSTRING(CELLPHONE,7,4) END AS CELLPHONE_3,
              EMAIL,
           	  CONTENTS,
           	  CREATE_DATE,
           	  CREATE_ID
         FROM SIX_COUNSELING
     ORDER BY SEQ DESC
	     <if test="start != null">
		 LIMIT #{start},#{end}    
		 </if>      		   
   </select>
   
   <select id="selectSixCounselingInfo" parameterType="java.util.HashMap" resultType="java.util.HashMap">
       SELECT SEQ,
      		  TERMS_AGREE,
           	  QNA1,
           	  QNA2,
           	  QNA3,
           	  NAME,
              CELLPHONE,
              SUBSTRING(CELLPHONE,1,3) CELLPHONE_1,
	     	  CASE LENGTH(CELLPHONE) WHEN 11 THEN SUBSTRING(CELLPHONE,4,4) 
		                             WHEN 10 THEN SUBSTRING(CELLPHONE,4,3) END AS CELLPHONE_2,
  	     	  CASE LENGTH(CELLPHONE) WHEN 11 THEN SUBSTRING(CELLPHONE,8,4) 
		      	                     WHEN 10 THEN SUBSTRING(CELLPHONE,7,4) END AS CELLPHONE_3,
              EMAIL,
           	  CONTENTS,
           	  CREATE_DATE,
           	  CREATE_ID
         FROM SIX_COUNSELING
        WHERE SEQ = #{seq} 
   </select>
   
</mapper>